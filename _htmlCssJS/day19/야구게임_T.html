<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>야구게임</h1>
    <ul>
        <li>
            세자리의 숫자는 중복되면 안됨, 각 숫자는 자리수를 갖고 있음!
        </li>
        <li>
            입력 숫자와 자리수 모두 일치하면 strike
        </li>
        <li>
            자리수에 상관없이 숫자가 포함만 되어 있으면 ball
        </li>
        <li>
            숫자가 전혀 없으면 out
        </li>
        <li>
            3strike면 게임 종료
        </li>
    </ul>
    <hr>
    <button type="button" id="startBtn">게임시작</button>
    <h1 id="comMsg"></h1>
    숫자 입력: <input type="text" id="myNum">
    <button type="button" id="try">게임 확인</button>
    <ol id="tries"></ol>

    <script>
        const comSet = new Set();
        let comNums = [];
        let count = 0;
        const comMsg = document.getElementById('comMsg');
        const tries = document.getElementById('tries');
        document.getElementById('startBtn').addEventListener('click', makeGame);
        document.getElementById('try').addEventListener('click', compareNum);
        
        //숫자가 아닌게 맞는지 확인, true -> 문자, false -> 숫자
        //'' 안에 들어간 숫자도 숫자로 인식! 무조건 문자로 적혀야 문자로 인식함
        //console.log(isNaN('ASDF')); 
        
        //입력값 유효성 체크 함수
        //숫자는 3자리여야 함.
        //숫자만 가능! 문자 X
        //중복값 안됨 111,222 X
        function validMyNum(myNum){
            if(myNum.length != 3){
                return false;
            }else if(isNaN(myNum)){
                return false;
            }else if(new Set(myNum.split("")).size != 3){
                return false;
            }else{
                return true;
            }
        }

        //유효성 체크 통과 
        //console.log(validMyNum('468'));


        //랜덤 숫자 3개 만들어서 컴퓨터의 세트,배열에 저장하는 함수
        function makeGame(){
            //기존 게임 내역 초기화
            tries.innerText = '';
            //기존 값 삭제
            comNums = [];
            comSet.clear();

            do {
                let rNum = Math.floor(Math.random()*9)+1;
                comSet.add(rNum);
                
            } while (comSet.size < 3);
            console.log(comSet);

            //set을 배열로 저장
            comSet.forEach((v)=>{
                comNums.push(v);
            })
            console.log(comNums);
            comMsg.innerText = '컴퓨터가 숫자를 결정했습니다.';
            
        }

        //
        function compareNum(){
            if(comSet.size == 0){
                comMsg.innerText = '먼저 컴퓨터의 숫자를 결정해주세요!';
                return;
            }else{
            
                count++;
                let myNumVal = document.getElementById('myNum');
                //유효성 검증
                if(validMyNum(myNumVal.value)){
                    console.log('valid 통과!!!');
                    //myNum이 들어갈 배열은 try를 누를 때마다 바뀌니까 상단에 선언되면 안됨
                    let myNums = myNumVal.value.split("");
                    console.log(myNums);
    
                    //스트라이크, 볼 개수 체크
                    let strike = 0, ball = 0;
    
                    //comNums, myNums 비교
                    //comNums 기준
                    for(let i=0; i<comNums.length; i++){
                        //myNums 기준
                        for(let j=0; j<myNums.length; j++){
                            if(comNums[i]==myNums[j]){
                                if(i==j){ //자리도 같다면
                                    strike++;
                                }else{
                                    ball++;
                                }
                                break; 
                                //for문이 2개 있을 때 안쪽에서 break걸면
                                //그 브레이크 기준 가장 가까운 for문만 벗어남
                            }
                        }
                    }  if(strike==0 && ball==0){
                        tries.innerHTML += `<li> ${myNums} => OUT!! </li>`;
                    }else{
                        if(strike==3){
                            tries.innerHTML += `<li> ${myNums} => Success!! </li>`;
                        }else{
                            tries.innerHTML += `<li> ${myNums} => ${strike}s, ${ball}b </li>`;
                        }
                    }
    
                }else{
                    console.log('valid 통과X!!!');
                    comMsg.innerText = '유효하지 않은 숫자입니다.';
                }
                myNumVal.value = "";
                myNumVal.focus();
                
            }
        }
        </script>
</body>
</html>